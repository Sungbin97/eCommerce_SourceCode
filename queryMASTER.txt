-- 통합 작업
-- 데이터베이스 사용
use team4db;

-- 회원 기본정보 테이블 --
create table tbl_memberInfo(
    mno int(30) primary key auto_increment,
    id varchar(50) not null,
    password varchar(50) not null,
    name varchar(50) not null,
    nickName varchar(50) not null,
    email varchar(50) not null,
    phoneNum varchar(50) not null,
    gender varchar(50) not null,
    sSNum varchar(50) not null,
    postcode varchar(50) not null, -- 우편번호
    address varchar(50) not null, -- 기본주소
    detailAddress varchar(50) not null, -- 세부주소
    auth varchar(50) not null,
    grade varchar(50) not null,
    point int(30)
);

-- 결제 정보 테이블
create table tbl_paymentInfo(
    mno int(30) not null,
    payINo int(30) primary key auto_increment,
    payName varchar(50),
    payContent varchar(50),
    foreign key (mno) references tbl_memberInfo (mno)
);

-- 상품 테이블
create table tbl_product(
    pno int(30) primary key auto_increment,
    pName varchar(50) not null,
    pMainCategory varchar(50) not null,
    pSubCategory varchar(50) not null,
    pSize varchar(50) ,
    pPrice int(30) not null,
    pAmount int(30) not null,
    pColor varchar(50) ,
    pRegdate DATETIME default now(),
    pImage varchar(50) not null,
    pInformation varchar(50) not null,
    pDelivery varchar(50),
    pImageURL varchar(200) ,
    pCode varchar(50) not null,
    pRating decimal(2,1),
    pReviewCnt int(20),
    pDiscount int(10)
);

-- 주문 테이블
create table tbl_order(
    mno int(30) not null, -- 회원번호(tbl_memberInfo)
    ono varchar(50) primary key , -- 주문번호
    pno int(30) not null,  -- 상품번호(tbl_product)
    payINo int(30) , -- 결제수단 번호(tbl_paymentInfo)
    -- delAddr varchar(50) not null, -- 배송지 주소
    -- 신규 추가
    postcode varchar(50) , -- 우편번호
    address varchar(50) , -- 주소(도로명)
    detailAddress varchar(50) not null, -- 상세주소
    usePoint int(50), -- 사용한 포인트
    receiverName varchar(30) , -- 받는 사람 성명
    receiverPhone varchar(50) , -- 밥는 사람 연락처
    message varchar(50) , -- 주문/배송 관련 메세지
    count int(30) , -- 주문개수
    productPrice int(30) , -- 상품 총 금액
    shipFee int(30) , -- 배송비
    totalPrice int(30) , -- 총 결제금액
    orderDate DATETIME default now(), -- 주문일시
    payStatus varchar(50) , -- 결재 상태
    deliveryStatus varchar(50) , -- 배송 상태
    exStatus boolean default 0, -- 교환반품취소 신청 여부
    foreign key (mno) references tbl_memberInfo (mno),
    foreign key (payINo) references tbl_paymentInfo (payINo)
);

insert into tbl_order (mno,ono, pno, payINo, postcode, address, detailAddress, usePoint,
                       receiverName, receiverPhone, message, count, productPrice, shipFee,
                       totalPrice, payStatus, deliveryStatus, exStatus)
values (8,'13124중매야ㅓ22',1,2,'1234','기본주소','세부주소',10,'받는사람 이름','01010','빨리주세요',24,100,3000,100000,'미완료','미완료',false);


-- 주문 상품 테이블
create table tbl_orderItem(
    orderItemno int auto_increment primary key,
    ono varchar(50) ,
    pno int,
    itemCount int not null,
    pPrice int not null,
    pDiscount int not null,
    savePoint int not null,
    FOREIGN KEY (ono) REFERENCES tbl_order(ono),
    FOREIGN KEY (pno) REFERENCES tbl_product(pno)
);

-- 리뷰 테이블
create table tbl_review(
    rno int(10) not null auto_increment primary key,
    pno int(10) not null,
    mno int(10),
    rRating int(10),
    rContent varchar(1000) not null,
    LIKEHIT int default 0,
    rImageURL varchar(150),
    rRegdate TIMESTAMP not null default now(),
    rUpdatedate TIMESTAMP not null default now()
);

-- 상품 옵션(아직 구현 작업중)
create table tbl_product_opt(
    pcno int(5) auto_increment primary key,
    pno int(5),
    pAmount int(100),
    psize varchar(30),
    pcolor varchar(30),
    pOptPrice int(11) default 0
);

-- ------------------------------------- 정현(끝)
-- ------------------------------------- 성빈(시작)

-- 메일 테이블
create table tbl_mail(
    mno int,
    email varchar(50)  null,
    mailNo int auto_increment primary key,
    subject varchar(70),
    text varchar(700),
    sendDate DATETIME default now(),
    reception varchar(1000),
    foreign key (mno) references tbl_memberInfo (mno)
);

-- ------------------------------------- 성빈(끝)
-- ------------------------------------- 상욱(시작)


-- 찜한 상품 테이블
create table tbl_interest(
    mno int(30) not null, -- 회원 번호
    itrNo int(30) primary key auto_increment, -- 찜 번호
    pno int(30) not null, -- 상품 번호
    interestDate DATETIME default now(), -- 찜한 일자시간
    foreign key (mno) references tbl_memberInfo (mno),
    foreign key (pno) references tbl_product (pno)
);

insert into tbl_interest(mno, pno) values (8,1);

-- 장바구니 테이블(상품 세부정보는 상품 table과 join하여 출력)
create table tbl_cart(
    mno int(30) not null,
    cno int(30) primary key auto_increment,
    pno int(30) not null,
    foreign key (mno) references tbl_memberInfo (mno),
    foreign key (pno) references tbl_product (pno)
);

insert into tbl_cart (mno, pno) values (8,1);

-- 취소/반품/교환 테이블
create table tbl_exchange(
    mno int(30) not null, -- 회원번호(tbl_memberInfo)
    ono varchar(50) not null, -- 주문번호(tbl_order)
    pno int(30) not null,  -- 상품번호(tbl_product)
    payINo int(30) not null, -- 결제수단 번호(tbl_paymentInfo)
    eno int(30) primary key auto_increment, -- 취소/반품/교환 번호
    exCategory varchar(30) not null, -- 분류(취소/반품/교환 중 택1)
    exContent varchar(1000) not null, -- 사유 내용
    exStatus varchar(50) not null, -- 진행 상태(접수중, 접수완료, 처리완료)
    exStartDate DATETIME default now(), -- 배송시작일시
    exEndDate DATETIME default now(), -- 배송종료일시
    foreign key (mno) references tbl_memberInfo (mno),
    foreign key (ono) references tbl_order (ono),
    foreign key (pno) references tbl_product (pno),
    foreign key (payINo) references tbl_paymentInfo (payINo)
);

-- 취소/반품/교환 신청 첨부파일 테이블
create table tbl_exchangeFiles(
    eno int(30) not null, -- 취소/반품/교환 신청번호
    ino int(30) primary key auto_increment, -- 파일번호
    img_name varchar(500) not null, -- 파일 이름
    path varchar(500) not null, -- 파일 경로
    uuid varchar(500) not null, -- 파일 UUID
    foreign key (eno) references tbl_exchange (eno)
);

-- 회원 배송지 정보 테이블
create table tbl_shipmentInfo(
    mno int(30) not null,
    sno int(30) primary key auto_increment,
    postcode varchar(50) not null,
    address varchar(50) not null,
    detailAddress varchar(50) not null,
    foreign key (mno) references tbl_memberInfo (mno)
);

-- 탈퇴 회원 테이블
create table tbl_deleteMem(
    delNo int(30) primary key auto_increment,
    id varchar(50) not null,
    password varchar(50) not null,
    name varchar(50) not null,
    nickName varchar(50) not null,
    email varchar(50) not null,
    phoneNum varchar(50) not null,
    gender varchar(50) not null,
    SSNum varchar(50) not null,
    postcode varchar(50) not null,
    address varchar(50) not null,
    detailAddress varchar(50) not null,
    auth varchar(50) not null,
    grade varchar(50) not null,
    delDate DATETIME default now() not null, -- 탈퇴 날짜
    delCategory varchar(50) not null, -- 탈퇴 이유 카테고리
    delContent varchar(150) -- 탈퇴 이유 세부내용
);

-- 배송현황 테이블 입력(주문 배송)
create table tbl_delivery(
    mno int(30) not null, -- 회원번호(tbl_memberInfo)
    ono varchar(50) not null, -- 주문번호(tbl_order)
    dno int(30) primary key auto_increment, -- 배송번호
    delCategory varchar(30) not null, -- 배송 종류(일반/특급 등)
    postcode varchar(50) not null, -- 우편번호
    address varchar(50) not null, -- 도로명 주소
    detailAddress varchar(50) not null, -- 세부주소
    delCompany varchar(30) not null, -- 택배사
    delStatus varchar(30) not null, -- 배송 상태
    delLocation varchar(50) not null, -- 배송 현재 위치
    delStartDate DATETIME default now(), -- 배송시작일시
    delEndDate DATETIME default now(), -- 배송종료일시
    foreign key (mno) references tbl_memberInfo (mno),
    foreign key (ono) references tbl_order (ono)
);

insert into tbl_delivery (mno, ono, delCategory, postcode, address, detailAddress, delCompany, delStatus, delLocation)
values (1,'1652853389085','일반','12345','도로명주소','세부주소','그린택배','출고 준비중','서울');

-- ------------------------------------- 상욱(끝)
-- ------------------------------------- 범석(시작)

-- 게시글 테이블
create table user_tbl(
    uNo int auto_increment primary key,
    userId varchar(30),
    userName varchar(30) not null unique key,
    userPassword varchar(30),
    title varchar(100) not null,
    content varchar(1000) not null,
    regDate date,
    modDate date,
    delete_state varchar(10) default 'Y'
);

-- 삭제된 게시글 저장될 테이블 (아직 구현중)
create table user_delete_tbl(
    uNo int auto_increment primary key,
    userId varchar(30),
    userName varchar(30) not null unique key,
    userPassword varchar(30),
    title varchar(100) not null,
    content varchar(1000) not null,
    regDate date,
    modDate date,
    delete_state varchar(10) default 'Y'
);

commit;

