<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.js"></script>
<!-- BootStrap -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css" integrity="sha384-HSMxcRTRxnN+Bdg0JdbxYKrThecOKuH5zCYotlSAcp1+c8xmyTe9GYg1l9a69psu" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap-theme.min.css" integrity="sha384-6pzBo3FDv/PJ8r2KRkGHifhEocL+1X2rVCTTkUfGk7/0pbek5mMa1upzvWbrUbOZ" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js" integrity="sha384-aJ21OjlMXNL5UyIl/XNwTMqvzeRMZH2w8c5cRVpzpU8Y5bApTppSuUkhZXN0VxHd" crossorigin="anonymous"></script>


<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    <h2>마이페이지-개인정보조회</h2>

    <!-- Mypage 메인으로 돌아가기 버튼 -->
    <button type="button" class="btn btn-primary" th:id="goBack">마이페이지 메인으로 돌아가기</button>

    <!-- MemberInfo -->
    <h3>개인정보</h3>
    <form class="forModify" th:action="@{/sw/mypage/memberInfo/memModify}" th:method="post">
        <ul>
            <div>
                <input type="hidden" name="mno" th:value="${memberInfo.mno}" readonly>
            </div>
            <div class="input-group col-xs-3">
                <span class="input-group-addon">아이디</span>
                <input type="text" name="id" class="form-control" placeholder="ID" aria-describedby="basic-addon1" th:value="${memberInfo.id}">
            </div>
            <div class="input-group col-xs-3">
                <span class="input-group-addon">비밀번호</span>
                <input type="password" name="password" class="form-control" placeholder="password" aria-describedby="basic-addon1" th:value="${memberInfo.password}">
            </div>
            <div class="input-group col-xs-3">
                <span class="input-group-addon">이름</span>
                <input type="text" name="name" class="form-control" placeholder="name" aria-describedby="basic-addon1" th:value="${memberInfo.name}">
            </div>
            <div class="input-group col-xs-3">
                <span class="input-group-addon">별명</span>
                <input type="text" name="nickName" class="form-control" placeholder="nickName" aria-describedby="basic-addon1" th:value="${memberInfo.nickName}">
            </div>
            <div class="input-group col-xs-3">
                <span class="input-group-addon">이메일</span>
                <input type="text" name="email" class="form-control" placeholder="email" aria-describedby="basic-addon1" th:value="${memberInfo.email}">
            </div>
            <div class="input-group col-xs-3">
                <span class="input-group-addon">전화번호</span>
                <input type="text" name="phoneNum" class="form-control" placeholder="phoneNum" aria-describedby="basic-addon1" th:value="${memberInfo.phoneNum}">
            </div>

            <div class="input-group col-xs-3">
                <span class="input-group-addon">주민등록번호</span>
                <input type="text" name="SSNum" class="form-control" placeholder="SSNumber" aria-describedby="basic-addon1" th:value="${memberInfo.SSNum}">
            </div>
            <div class="btn-group">
                <label>성별 : </label>
                <label>
                    <input type="checkbox" name="gender" id="option1" th:if="${memberInfo.gender == '남성'}" th:value="'남성'" checked> 남성
                </label>
                <label>
                    <input type="checkbox" name="gender" id="option2" th:if="${memberInfo.gender == '여성'}" th:value="'여성'" checked> 여성
                </label>
            </div><br/>
            <button type="button" class="btn btn-secondary" id="getPostCode">우편번호 찾기</button>
            <div class="input-group col-xs-3">
                <span class="input-group-addon">주소</span>
                <input type="text" name="postcode" class="form-control" placeholder="postcode" aria-describedby="basic-addon1" th:value="${memberInfo.postcode}">
                <input type="text" name="address" class="form-control" placeholder="postcode" aria-describedby="basic-addon1" th:value="${memberInfo.address}">
                <input type="text" name="detailAddress" class="form-control" placeholder="postcode" aria-describedby="basic-addon1" th:value="${memberInfo.detailAddress}">
            </div><br/>
            <div>
                <input type="submit" class="btn btn-primary" value="개인정보 수정등록">
            </div>
        </ul>

    </form>
    <hr/>

    <!-- shipmentInfo -->
    <h3>배송지 정보</h3>
    <ul>
        <button class="btn btn-info addShipBtn">배송지 신규등록</button>
    </ul>
    <br/>
    <div class="shipList" th:each="shipment : ${shipmentList}">
        <ul>
            <li>
                <input type="hidden" th:id="mno" th:value="${shipment.mno}">
                <input type="hidden" th:id="sno" th:value="${shipment.sno}">
                <div th:id="shipPostcode" th:text="${shipment.postcode}"></div>
                <div th:id="shipAddress" th:text="${shipment.address}"></div>
                <div th:id="shipDetailAddress" th:text="${shipment.detailAddress}"></div>
            </li>
        </ul>
    </div>
    <hr/>

    <!-- PaymentInfo -->
    <h3>결제 정보</h3>
    <ul>
        <button class="btn btn-info addPayBtn">결제수단 신규등록</button>
    </ul>
    <div class="payList" th:each="payment : ${paymentList}">
        <ul>
            <li>
                <input type="hidden" th:id="mno" th:value="${payment.mno}">
                <input type="hidden" th:id="pno" th:value="${payment.pno}">
                <div th:id="payName" th:text="${payment.payName}"></div>
                <div th:id="payContent" th:text="${payment.payContent}"></div>
            </li>
        </ul>
    </div>

    <hr/>

    <!-- 회원 탈퇴 -->
    <form th:action="@{/sw/mypage/memberInfo/memDelete}" th:method="get">
        <input type="hidden" name="mno" th:value="${memberInfo.mno}">
        <input type="submit" class="btn btn-primary" value="회원탈퇴">
    </form>

    <!-- Modal 모음(아래) --------------------------------------------------------------------------------------------- -->
    <!-- ship modal -->
    <div class="shipModal modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="ship-modal-title" th:text="'배송지 신규등록'"></h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <!-- 숨김 영역 -->
                        <input type="hidden" name="mnoModal" readonly />
                        <input type="hidden" name="snoModal" readonly />
                    </div>
                    <div class="form-group">
                        <label>우편번호</label>
                        <input type="text" name="postcodeModal" placeholder="우편번호" readonly />
                        <button type="button" class="btn btn-info" id="getPostCodeModal">우편번호 찾기</button>
                    </div>
                    <div class="form-group">
                        <label>도로명 주소</label>
                        <input type="text" name="addressModal" placeholder="도로명 주소" readonly/>
                    </div>
                    <div class="form-group">
                        <label>상세 주소</label>
                        <input type="text" name="detailAddressModal" placeholder="상세 주소" required/>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">닫기</button>
                    <button type="button" class="btn btn-primary shipSaveBtn">저장</button>
                    <button type="button" class="btn btn-warning shipModifyBtn">수정</button>
                    <button type="button" class="btn btn-danger shipDeleteBtn">삭제</button>
                </div>
            </div>
        </div>
    </div>
    <!-- pay modal -->
    <div class="payModal modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="pay-modal-title" th:text="'결제수단 신규등록'"></h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <!-- 숨김 영역 -->
                        <input type="hidden" name="mnoModal" readonly />
                        <input type="hidden" name="pnoModal" readonly />
                    </div>
                    <div class="form-group">
                        <label>결제수단 종류</label>
                        <select name="payNameModal" size="1" required>
                            <option value="none">==카테고리를 선택하세요==</option>
                            <option value="신용카드">신용카드</option>
                            <option value="체크카드">체크카드</option>
                            <option value="카카오페이">카카오페이</option>
                            <option value="휴대폰결제">휴대폰결제</option>
                            <option value="페이코">페이코</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>결제수단 세부내용</label>
                        <input type="text" name="payContentModal" placeholder="결제수단 세부내용" required/>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">닫기</button>
                    <button type="button" class="btn btn-primary paySaveBtn">저장</button>
                    <button type="button" class="btn btn-warning payModifyBtn">수정</button>
                    <button type="button" class="btn btn-danger payDeleteBtn">삭제</button>
                </div>
            </div>
        </div>
    </div>
</body>

<script src="http://dmaps.daum.net/map_js_init/postcode.v2.js?autoload=false"></script>
<script>
    $(document).ready(function (){

        // 배송지 Modal

        // 1. 배송지 신규 등록 ----------------------------------------------------------------------------------
        // 배송지 신규등록 버튼 Click => modal 팝업
        $(".addShipBtn").click(function (e){
            // 기존에 입력된 value 초기화
            $(".ship-modal-title").text('배송지 신규등록')
            $("input[name='postcodeModal']").val("")
            $("input[name='addressModal']").val("")
            $("input[name='detailAddressModal']").val("")
            // 수정버튼 숨기기
            $(".shipModifyBtn").hide();
            $(".shipDeleteBtn").hide();
            $(".shipSaveBtn").show();
            // 모달 보여주기
            $(".shipModal").modal('show');
        })
        // shipModal 우편번호 검색 버튼 클릭하면
        $("#getPostCodeModal").click(function (){
            daum.postcode.load(function(){
                new daum.Postcode({
                    oncomplete: function(data) {
                        // 우편번호 검색 후 주소 클릭하면 아래 실행
                        $("input[name=postcodeModal]").val(data.zonecode); // 우편번호 태그에 값 업데이트
                        $("input[name=addressModal]").val(data.roadAddress); // 주소 태그에 값 업데이트
                    }
                }).open();
            });
        })
        // 배송지 신규등록 => 저장 버튼 Click => ajax 통신 => 데이터 등록
        $(".shipSaveBtn").click(function (e){
            var data ={
                mno:$("input[name=mno]").val(),
                postcode:$("input[name=postcodeModal]").val(),
                address:$("input[name=addressModal]").val(),
                detailAddress:$("input[name=detailAddressModal]").val()
            }
            console.log("modal => 입력받은 data: ",data)
            $.ajax({
                url:'/sw/mypage/memberInfo/shipAdd',
                method:'post',
                data:JSON.stringify(data),
                contentType:'application/json; charset=utf-8',
                dataType:'json',
                success:function (result){
                    console.log("주소 저장 => Ajax통신 성공 후 받은 result: ",result);
                    self.location.reload();
                }
            })
            $(".shipModal").modal('hide')
        })
        // 2. 배송지 수정/삭제 ----------------------------------------------------------------------------------
        // 배송지 주소 Click => modal 팝업
        $(".shipList").on("click",function (){
            // 클릭한 결제수단 정보 modal input창에 입력하기
            var targetPay = $(this);
            $("input[name='mnoModal']").val(targetPay.find("#mno").val())
            $("input[name='snoModal']").val(targetPay.find("#sno").val())
            $("input[name='postcodeModal']").val(targetPay.find("#shipPostcode").text())
            $("input[name='addressModal']").val(targetPay.find("#shipAddress").text())
            $("input[name='detailAddressModal']").val(targetPay.find("#shipDetailAddress").text())
            // 저장버튼 숨기기
            $(".shipSaveBtn").hide();
            $(".shipModifyBtn").show();
            $(".shipDeleteBtn").show();
            // 모달 제목 변경
            $(".ship-modal-title").text('배송지 수정')
            // 모달 보여주기
            $(".shipModal").modal('show');
        })
        // 배송지 수정 => 수정 버튼 Click => ajax 통신 => 데이터 수정
        $(".shipModifyBtn").click(function (e){
            var data ={
                mno:$("input[name=mnoModal]").val(),
                sno:$("input[name=snoModal]").val(),
                postcode:$("input[name=postcodeModal]").val(),
                address:$("input[name=addressModal]").val(),
                detailAddress:$("input[name=detailAddressModal]").val()
            }
            console.log("modal => 입력받은 data: ",data)
            $.ajax({
                url:'/sw/mypage/memberInfo/shipModify',
                method:'post',
                data:JSON.stringify(data),
                contentType:'application/json; charset=utf-8',
                dataType:'json',
                success:function (result){
                    console.log("주소 저장 => Ajax통신 성공 후 받은 result: ",result);
                    self.location.reload();
                }
            })
            $(".shipModal").modal('hide')
        })
        // 배송지 삭제 => 삭제 버튼 Click => ajax 통신 => 데이터 수정
        $(".shipDeleteBtn").click(function (e){
            alert("정말 삭제하시겠습니까?")
            var data ={
                mno:$("input[name=mnoModal]").val(),
                sno:$("input[name=snoModal]").val(),
                postcode:$("input[name=postcodeModal]").val(),
                address:$("input[name=addressModal]").val(),
                detailAddress:$("input[name=detailAddressModal]").val()
            }
            console.log("modal => 입력받은 data: ",data)
            $.ajax({
                url:'/sw/mypage/memberInfo/shipDelete',
                method:'post',
                data:JSON.stringify(data),
                contentType:'application/json; charset=utf-8',
                dataType:'json',
                success:function (result){
                    console.log("주소 저장 => Ajax통신 성공 후 받은 result: ",result);
                    self.location.reload();
                }
            })
            $(".shipModal").modal('hide')
        })

        // 결제수단 Modal

        // 1. 결제수단 신규 등록 ----------------------------------------------------------------------------------
        // 배송지 신규등록 버튼 Click => modal 팝업
        $(".addPayBtn").click(function (e){
            // 기존에 입력된 value 초기화
            $(".pay-modal-title").text('결제수단 신규등록')
            $("input[name='payNameModal']").val("")
            $("input[name='payContentModal']").val("")
            // 수정버튼 숨기기
            $(".payModifyBtn").hide();
            $(".payDeleteBtn").hide();
            $(".paySaveBtn").show();
            // 모달 보여주기
            $(".payModal").modal('show');
        })

        // 결제수단 신규등록 => 저장 버튼 Click => ajax 통신 => 데이터 등록
        $(".paySaveBtn").click(function (e){
            var data ={
                mno:$("input[name=mno]").val(),
                payName:$("select[name=payNameModal]").val(),
                payContent:$("input[name=payContentModal]").val()
            }
            console.log("modal => 입력받은 data: ",data)
            $.ajax({
                url:'/sw/mypage/memberInfo/payAdd',
                method:'post',
                data:JSON.stringify(data),
                contentType:'application/json; charset=utf-8',
                dataType:'json',
                success:function (result){
                    console.log("주소 저장 => Ajax통신 성공 후 받은 result: ",result);
                    self.location.reload();
                }
            })
            $(".payModal").modal('hide')
        })

        // 2. 결제수단 수정/삭제 ----------------------------------------------------------------------------------
        // 결제수단 list Click => modal 팝업
        $(".payList").on("click",function (){
            // 클릭한 결제수단 정보 modal input창에 입력하기
            var targetPay = $(this);
            $("input[name='mnoModal']").val(targetPay.find("#mno").val())
            $("input[name='pnoModal']").val(targetPay.find("#pno").val())
            $("input[name='payNameModal']").val(targetPay.find("#payName").text())
            $("input[name='payContentModal']").val(targetPay.find("#payContent").text())
            // 저장버튼 숨기기
            $(".paySaveBtn").hide();
            $(".payModifyBtn").show();
            $(".payDeleteBtn").show();
            // 모달 제목 변경
            $(".pay-modal-title").text('결제수단 수정')
            // 모달 보여주기
            $(".payModal").modal('show');
        })
        // 결제수단 수정 => 수정 버튼 Click => ajax 통신 => 데이터 수정
        $(".payModifyBtn").click(function (e){
            var data ={
                mno:$("input[name=mnoModal]").val(),
                pno:$("input[name=pnoModal]").val(),
                payName:$("select[name=payNameModal]").val(),
                payContent:$("input[name=payContentModal]").val()
            }
            console.log("modal => 입력받은 data: ",data)
            $.ajax({
                url:'/sw/mypage/memberInfo/payModify',
                method:'post',
                data:JSON.stringify(data),
                contentType:'application/json; charset=utf-8',
                dataType:'json',
                success:function (result){
                    console.log("주소 저장 => Ajax통신 성공 후 받은 result: ",result);
                    self.location.reload();
                }
            })
            $(".payModal").modal('hide')
        })
        // 결제수단 삭제 => 삭제 버튼 Click => ajax 통신 => 데이터 수정
        $(".payDeleteBtn").click(function (e){
            alert("정말 삭제하시겠습니까?")
            var data ={
                mno:$("input[name=mnoModal]").val(),
                pno:$("input[name=pnoModal]").val(),
                payName:$("select[name=payNameModal]").val(),
                payContent:$("input[name=payContentModal]").val()
            }
            console.log("modal => 입력받은 data: ",data)
            $.ajax({
                url:'/sw/mypage/memberInfo/payDelete',
                method:'post',
                data:JSON.stringify(data),
                contentType:'application/json; charset=utf-8',
                dataType:'json',
                success:function (result){
                    console.log("주소 저장 => Ajax통신 성공 후 받은 result: ",result);
                    self.location.reload();
                }
            })
            $(".payModal").modal('hide')
        })

        // Modal 외 이벤트 ----------------------------------------------------------------------------------------------
        // 성별 선택 체크박스
        $('input[type="checkbox"][name="gender"]').click(function(){
            if($(this).prop('checked')){
                $('input[type="checkbox"][name="gender"]').prop('checked',false);
                $(this).prop('checked',true);
            }
        });
        // 개인정보관리 우편번호 검색 버튼 클릭하면
        $("#getPostCode").click(function (){
            daum.postcode.load(function(){
                new daum.Postcode({
                    oncomplete: function(data) {
                        // 우편번호 검색 후 주소 클릭하면 아래 실행
                        $("input[name=postcode]").val(data.zonecode); // 우편번호 태그에 값 업데이트
                        $("input[name=address]").val(data.roadAddress); // 주소 태그에 값 업데이트
                    }
                }).open();
            });
        })
        // Mypage 메인으로 돌아가기 버튼 클릭하면 동작
        $("#goBack").click(function (){
            var mno = $("input[name=mno]").val();
            window.location.href = '/sw/mypage/main?mno='+mno;
        })
    })
</script>
</html>