use team4db;

-- 회원 기본정보 테이블
create table tbl_memberInfo(
    mno int(30) primary key auto_increment, -- 회원번호
    id varchar(50) not null, -- 아이디
    password varchar(50) not null, -- 비밀번호
    name varchar(50) not null, -- 이름
    nickName varchar(50) not null, -- 별명
    gender varchar(50) not null, -- 성별
    sSNum varchar(50) not null, -- 주민번호
    email varchar(50) not null, -- 이메일
    phoneNum varchar(50) not null, -- 전화번호
    mobileNum varchar(50) not null, -- 휴대폰 번호
    postcode varchar(50) not null, -- 우편번호
    address varchar(50) not null, -- 기본주소
    detailAddress varchar(50) not null, -- 세부주소
    interestSports varchar(50) default '없음', -- 관심 운동
    auth varchar(50) not null, -- 회원 권한
    grade varchar(50) not null, -- 회원 등급
    point int(100) default 0 -- 회원 보유 포인트
);

update tbl_memberInfo set point = 750 where mno=2;

-- 탈퇴 회원 테이블
create table tbl_deleteMem(
    dMNo int(30) primary key auto_increment, -- 탈퇴회원 번호
    id varchar(50) not null, -- 아이디
    password varchar(50) not null, -- 비밀번호
    name varchar(50) not null, -- 이름
    nickName varchar(50) not null, -- 별명
    gender varchar(50) not null, -- 성별
    sSNum varchar(50) not null, -- 주민번호
    email varchar(50) not null, -- 이메일
    phoneNum varchar(50) not null, -- 전화번호
    mobileNum varchar(50) not null, -- 휴대폰 번호
    postcode varchar(50) not null, -- 우편번호
    address varchar(50) not null, -- 기본주소
    detailAddress varchar(50) not null, -- 세부주소
    interestSports varchar(50), -- 관심 운동
    auth varchar(50), -- 회원 권한
    grade varchar(50), -- 회원 등급
    point int(100), -- 회원 보유 포인트
    dMDate DATETIME default now() not null, -- 탈퇴 날짜
    dMCategory varchar(50) not null, -- 탈퇴 이유 카테고리
    dMContent varchar(150) -- 탈퇴 이유 세부내용
);

-- 상품 테이블
create table tbl_product(
    pno int(30) primary key auto_increment, -- 상품 번호
    pName varchar(50) not null, -- 상품명
    pSize varchar(50), -- 상품 사이즈 (추후 별도 테이블로 분리 예정)
    pPrice int(50), -- 상품 가격 (추후 별도 테이블로 분리 예정)
    pAmount int(30), -- 상품 재고
    pColor varchar(50), -- 상품 색상
    pRegdate DATETIME default now(), -- 상품 등록일
    pImage varchar(300) not null, -- 상품 대표 이미지
    pInformation varchar(300) not null, -- 상품 세부정보 대표 이미지
    pRating decimal(2,1), -- 상품 평점
    pReviewCnt int(20), -- 상품 리뷰 개수
    pDiscount int(10), -- 상품 할인률(%)
    pCatecode varchar(30) -- 카테고리 코드 **신규 추가
);

-- 상품 카테고리 테이블
create table tbl_product_cate( -- 신규 추가
    tier int(1) not null, -- 카테고리 등급 ( 대분류 1 , 중분류 2 ,소분류 3)
    pCateName varchar(30) not null, -- 카테고리 이름
    pCatecode varchar(30) not null, -- 카테고리 코드
    cateParent varchar(30) -- 바로 상위 카테고리
    -- primary key(pCatecode)
);

-- 상품 옵션 테이블 (옵션2 ,옵션2 이름 추가)
create table tbl_product_opt(
    pcno int(5) auto_increment primary key,
    pno int(5),
    pAmount int(100), -- 재고
    pOption varchar(30) default '없음', -- 옵션 기본값
    pOptionName varchar(30)  default '없음' , -- 옵션 기본값 이름
    pOption2 varchar(30) default '없음', -- 옵션 기본값
    pOptionName2 varchar(30)  default '없음' , -- 옵션 기본값 이름
    pColor varchar(30) default '없음' , -- 색상
    pOptionPrice int(11) default 0 -- 옵션 추가금액
);

select distinct pOption, pOptionName, pOption2, pOptionName2 from tbl_product_opt where pno=402;

insert into tbl_product_opt (pno, pAmount, pOption, pOptionName,
                             pOption2, pOptionName2, pColor, pOptionPrice)
values (402,10,'S','사이즈','토끼','그림','red',200);
insert into tbl_product_opt (pno, pAmount, pOption, pOptionName,
                             pOption2, pOptionName2, pColor, pOptionPrice)
values (402,10,'S','사이즈','토끼','그림','blue',200);
insert into tbl_product_opt (pno, pAmount, pOption, pOptionName,
                             pOption2, pOptionName2, pColor, pOptionPrice)
values (402,10,'S','사이즈','다람쥐','그림','red',200);
insert into tbl_product_opt (pno, pAmount, pOption, pOptionName,
                             pOption2, pOptionName2, pColor, pOptionPrice)
values (402,10,'S','사이즈','다람쥐','그림','blue',200);

insert into tbl_product_opt (pno, pAmount, pOption, pOptionName,
                             pOption2, pOptionName2, pColor, pOptionPrice)
values (402,10,'M','사이즈','토끼','그림','red',200);
insert into tbl_product_opt (pno, pAmount, pOption, pOptionName,
                             pOption2, pOptionName2, pColor, pOptionPrice)
values (402,10,'M','사이즈','토끼','그림','blue',200);
insert into tbl_product_opt (pno, pAmount, pOption, pOptionName,
                             pOption2, pOptionName2, pColor, pOptionPrice)
values (402,10,'M','사이즈','다람쥐','그림','red',200);
insert into tbl_product_opt (pno, pAmount, pOption, pOptionName,
                             pOption2, pOptionName2, pColor, pOptionPrice)
values (402,10,'M','사이즈','다람쥐','그림','blue',200);

-- 주문 테이블(tbl_orderItem과 set)
create table tbl_order(
                          mno int(30) not null, -- 회원번호
                          ono varchar(50) primary key , -- 주문번호
                          orderDate DATETIME default now(), -- 주문일자
                          receiverName varchar(30) , -- 받는 사람 성명
                          receiverPhone varchar(50) , -- 밥는 사람 연락처
                          postcode varchar(50), -- 우편번호
                          address varchar(50), -- 기본주소
                          detailAddress varchar(50) not null, -- 상세주소
                          message varchar(50) , -- 배송 메세지
                          tProductPrice int(30) , -- 총 상품가격(순수 상품가격)
                          tShipFee int(30) , -- 배송비
                          tUsePoint int(50), -- 총 사용한 포인트
                          tTotalPrice int(30) , -- 최총 총 결제금액(최종 결제금액 = 상품가+배송비-사용한포인트)
                          tPayStatus varchar(50) default '결제완료', -- 결제상태
                          tSavePoint int(50), -- 총 적립된 포인트
                          foreign key (mno) references tbl_memberInfo (mno)
);

insert into tbl_order (mno, ono, receiverName, receiverPhone,
                       postcode, address, detailAddress, message,
                       tProductPrice, tShipFee, tUsePoint, tTotalPrice,
                       tSavePoint)
values (1,'12345678','받는이이름','받는이연락처','13455','기본주소','세부주소','감사합니다.'
       ,5000,3000,4000,4000,100);

insert into tbl_order (mno, ono, receiverName, receiverPhone,
                       postcode, address, detailAddress, message,
                       tProductPrice, tShipFee, tUsePoint, tTotalPrice,
                       tSavePoint)
values (2,'123456789','받는이이름','받는이연락처','13455','기본주소','세부주소','감사합니다.'
       ,3000,3000,1000,5000,250);

insert into tbl_order (mno, ono, receiverName, receiverPhone,
                       postcode, address, detailAddress, message,
                       tProductPrice, tShipFee, tUsePoint, tTotalPrice,
                       tSavePoint)
values (2,'1234567890','받는이이름','받는이연락처','1212','기본주소','세부주소','테스트입니다.'
       ,15000,3000,1000,17000,750);


-- 주문 상품 테이블
create table tbl_orderItem( -- SW 수정 reviewStatus 추가 20220530
                              ono varchar(50), -- 주문 번호
                              oINo int(50) auto_increment primary key, -- 주문상품 번호
                              pno int(50), -- 상품 번호
                              iName varchar(50), -- 상품명
                              iOption varchar(50), -- 상품 옵션1
                              iOptionName varchar(50), -- 상품 옵션1 이름
                              iOption2 varchar(50), -- 상품 옵션1
                              iOptionName2 varchar(50), -- 상품 옵션1 이름
                              iColor varchar(50), -- 상품 색상명
                              iPrice int(50), -- 상품 가격(순수 상품가격)
                              iDiscount int(30), -- 상품 할인률(%)
                              iDisPrice int(50), -- 할인된 상품 가격 (상품 가격에 할인률 적용한 가격)
                              iCount int(50), -- 상품 수량(주문한 상품 수량)
                              iSavePoint int(50), -- 새로 추가(하나의 상품별 적립 포인트)!!!!!!!!!!!!!!
                              iTotalPrice int(50), -- 최종 결재금액
                              iDeliveryStatus varchar(30) default '배송전', -- 배송 상태
                              iExStatus varchar(30) default '미신청', -- 교환반품취소 신청 상태
                              iReviewStatus varchar(30) default '미등록', -- 리뷰 등록 여부
                              FOREIGN KEY (ono) REFERENCES tbl_order(ono),
                              FOREIGN KEY (pno) REFERENCES tbl_product(pno)
);

alter table tbl_orderitem add iReviewStatus varchar(30) default '미등록';

insert into tbl_orderItem (ono, pno, iName, iOption, iOptionName, iOption2, iOptionName2,
                           iColor, iPrice, iDiscount, iDisPrice, iCount, iSavePoint,
                           iTotalPrice)
values ('1234567890',404,'테스트상품명2','95','사이즈','별','장식','BLACK',5000,0,5000,1,250,5000);
insert into tbl_orderItem (ono, pno, iName, iOption, iOptionName, iOption2, iOptionName2,
                           iColor, iPrice, iDiscount, iDisPrice, iCount, iSavePoint,
                           iTotalPrice)
values ('1234567890',405,'테스트상품명3','115','사이즈','해','장식','RED',10000,0,10000,1,500,10000);

delete from tbl_order where ono='123456789';
-- 리뷰 테이블
create table tbl_review( -- 수정 SW 20220530 (rImageURL 삭제 => 이미지 별도 테이블로 분리, oINo 추가)
                           rno int(10) not null auto_increment primary key, -- 리뷰번호
                           pno int(10) not null, -- 상품번호
                           mno int(10), -- 회원번호
                           oINo int(10), -- 주문상품번호
                           rRating int(10), -- 평점
                           rContent varchar(1000) not null, -- 리뷰내용
                           LIKEHIT int default 0, -- 좋아요 개수
    -- rImageURL varchar(150), -- 리뷰 첨부 이미지
                           rRegdate TIMESTAMP not null default now(), -- 리뷰 등록일
                           rUpdatedate TIMESTAMP not null default now() -- 리뷰 수정일
);

-- 리뷰 첨부파일 테이블 -- 신규 생성 SW 20220530
create table tbl_reviewFiles(
                                rno int(30) not null, -- 리뷰 번호
                                rFNo int(30) primary key auto_increment, -- 파일번호
                                img_name varchar(500) not null, -- 파일 이름
                                path varchar(500) not null, -- 파일 경로
                                uuid varchar(500) not null, -- 파일 UUID
                                foreign key (rno) references tbl_review (rno)
);



-- 리뷰 추천 테이블
create table tbl_review_LIKE(
                                LIKENO int(10) NOT NULL PRIMARY KEY , -- 리뷰 좋아요 번호
                                pno int(10), -- 상품 번호
                                mno int(10) , -- 회원 번호
                                rmno int(10) , --
                                RNO int(10) -- 리뷰 번호
);

-- 회원 배송지 정보 테이블
create table tbl_shipmentInfo(
                                 mno int(30) not null, -- 회원번호
                                 sno int(30) primary key auto_increment, -- 배송지주소번호
                                 shipName varchar(50) not null, -- 배송지이름
                                 postcode varchar(50) not null, -- 우편번호
                                 address varchar(50) not null, -- 기본주소
                                 detailAddress varchar(50) not null, -- 세부주소
                                 foreign key (mno) references tbl_memberInfo (mno)
);

-- 찜한 상품 테이블
create table tbl_interest(
                             mno int(30) not null, -- 회원 번호
                             itrNo int(30) primary key auto_increment, -- 찜 번호
                             pno int(30) not null, -- 상품 번호
                             itrDate DATETIME default now(), -- 찜한 일자시간
                             foreign key (mno) references tbl_memberInfo (mno),
                             foreign key (pno) references tbl_product (pno)
);

insert into tbl_interest(mno, pno) values (2,13);
insert into tbl_interest(mno, pno) values (2,25);
insert into tbl_interest(mno, pno) values (2,31);


-- 장바구니 테이블(상품 세부정보는 tbl_product join하여 출력)
create table tbl_cart(
                         mno int(30) not null, -- 회원번호
                         cno int(30) primary key auto_increment, -- 장바구니 번호
                         pno int(30) not null, -- 상품번호
                         cName varchar(50), -- 상품명
                         cOption varchar(50), -- 상품 옵션1
                         cOptionName varchar(50), -- 상품 옵션1 이름
                         cOption2 varchar(50), -- 상품 옵션1
                         cOptionName2 varchar(50), -- 상품 옵션1 이름
                         cColor varchar(50), -- 상품 색상명
                         cPrice int(50), -- 상품 가격(순수 상품가격)
                         cDiscount int(30), -- 상품 할인률(%)
                         cDisPrice int(50), -- 할인된 상품 가격 (상품 가격에 할인률 적용한 가격)
                         cCount int(50), -- 상품 수량(주문한 상품 수량)
                         cTotalPrice int(50), -- 최종 결재금액
                         foreign key (mno) references tbl_memberInfo (mno),
                         foreign key (pno) references tbl_product (pno)
);

insert into tbl_cart (mno, pno, cName, cOptionName, cOption, cOptionName2, cOption2,
                      cColor, cPrice, cDiscount, cDisPrice, cCount, cTotalPrice)
values (2,1,'상품명1','사이즈','100','장식','다람쥐','Blue',1000,0.5,500,2,1000);
insert into tbl_cart (mno, pno, cName, cOptionName, cOption, cOptionName2, cOption2,
                      cColor, cPrice, cDiscount, cDisPrice, cCount, cTotalPrice)
values (2,2,'상품명2','사이즈','100','장식','토끼','Red',1000,0,1000,2,2000);
insert into tbl_cart (mno, pno, cName, cOptionName, cOption, cOptionName2, cOption2,
                      cColor, cPrice, cDiscount, cDisPrice, cCount, cTotalPrice)
values (2,3,'상품명3','사이즈','100','장식','토끼','Red',1000,0,1000,4,2000);


-- 취소/반품/교환 테이블 *수정 SW 0528
create table tbl_exchange(
                             mno int(30) not null, -- 회원번호(tbl_memberInfo)
                             ono varchar(50) not null, -- 주문번호(tbl_order)
                             newOno varchar(50) default '-', -- 처리 후 신규발행한 주문서 번호
                             pno int(30) not null,  -- 상품번호(tbl_product)
                             eno int(30) primary key auto_increment, -- 취소/반품/교환 번호
                             exCategory varchar(30) not null, -- 분류(취소/반품/교환 중 택1)
                             exContent varchar(1000) not null, -- 사유 내용
                             exStatus varchar(50) not null, -- 진행 상태(접수중, 접수완료, 처리완료)
                             exDate DATETIME default now(), -- 신청일
                             exEndDate DATETIME, -- 처리 완료일
                             eOptionName varchar(50),
                             eOption varchar(50),
                             eOptionName2 varchar(50),
                             eOption2 varchar(50),
                             color varchar(50),
                             foreign key (mno) references tbl_memberInfo (mno),
                             foreign key (ono) references tbl_order (ono),
                             foreign key (pno) references tbl_product (pno)
);

alter table tbl_exchange add newOno varchar(50) default '-';


-- 취소/반품/교환 신청 첨부파일 테이블
create table tbl_exchangeFiles(
                                  eno int(30) not null, -- 취소/반품/교환 신청번호
                                  ino int(30) primary key auto_increment, -- 파일번호
                                  img_name varchar(500) not null, -- 파일 이름
                                  path varchar(500) not null, -- 파일 경로
                                  uuid varchar(500) not null, -- 파일 UUID
                                  foreign key (eno) references tbl_exchange (eno)
);

-- 메일 테이블 -- SB
create table tbl_mail(
                         mno int,
                         email varchar(50)  null,
                         mailNo int auto_increment primary key,
                         subject varchar(70),
                         text varchar(700),
                         sendDate DATETIME default now(),
                         reception varchar(1000),
                         foreign key (mno) references tbl_memberInfo (mno)
);

-- 상품 이미지 테이블 -- SB
create table tbl_product_img(
                                ino int primary key auto_increment,
                                pno int,
                                pName varchar(50),
                                pThumbnail varchar(500),
                                pImage varchar(300), -- 파일명
                                pImagePath varchar(500) -- 저장경로
);

-- 상품 정보 이미지 테이블 -- SB
create table tbl_product_infoImg(
                                    infoNo int primary key auto_increment,
                                    pno int,
                                    pName varchar(50),
                                    pInformation varchar(300),
                                    pInfoPath varchar(500) -- 저장경로
);

-- 배송 현황 테이블 -- SW
create table tbl_delivery(
                             mno int(50) not null, -- 회원번호
                             oINo int(50) not null, -- 주문상품 번호
                             dno int primary key auto_increment, -- 배송 번호
                             dCompanyName varchar(50) not null, -- 택배사 이름
                             dCategory varchar(50) not null, -- 택배 종류(일반구매/반품/교환)
                             dOption varchar(50) not null, -- 택배 옵션(일반/특급/퀵 등)
                             dLocation varchar(50), -- 택배 현재 위치
                             dStartDate DATETIME, -- 배송 시작일
                             dEndDate DATETIME, -- 배송 종료일
                             dStatus varchar(50) not null, -- 배송 상태(배송준비중 등)
                             foreign key (mno) references tbl_memberInfo (mno),
                             foreign key (oINo) references tbl_orderItem (oINo)
);

create table user_tbl(
                         uNo int auto_increment primary key,
                         userId varchar(30),
                         userName varchar(30) not null unique key,
                         userPassword varchar(30),
                         title varchar(100) not null,
                         content varchar(1000) not null,
                         regDate date,
                         modDate date
);

insert into user_tbl (userName,
                      title, content)
values ('테스트이름','어깨넓어지기','알아서 넓히세요');


commit;